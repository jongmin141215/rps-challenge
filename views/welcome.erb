<script>
  var pusher = new Pusher('<%= ENV['PUSHER_KEY'] %>', { authEndpoint: '/auth' } );
  var channel = pusher.subscribe('presence-lobby');
  channel.bind('pusher:subscription_succeeded', function(members) {
    channel.members.each(function(member) {
      $('#users_online').append('<div class="user" data-name="' + member.info.name + '">' + member.info.name + '<button type="button" class="challenge"> Challenge</button></div>')
    })
  })
  channel.bind('pusher:member_added', function(member) {
    $('#users_online').append('<div class="user" data-name="' + member.info.name + '">' + member.info.name + '<button type="button" class="challenge"> Challenge</button></div>')
  })
  channel.bind('pusher:member_removed', function(member) {
    $('#users_online div[data-name="' + member.info.name + '"]').remove();
  })

  var challenge_channel = pusher.subscribe('<%= current_user.name %>_channel');
  challenge_channel.bind('challenge', function(data) {
    var response = confirm(data.challenger + ' challenged you. Do you want to accept the challenge?');
    if (response) {
      $.post('/accept_challenge', {challenger: data.challenger, challengee: data.challengee})
    }
  })

  // var private_pusher = new Pusher('<%= ENV['PUSHER_KEY'] %>', { authEndpoint: '/private_auth'} )
  // var private_channel = private_pusher.subscribe('private-game');
  // private_channel.bind('rps', function() {
  //
  // })
  $(document).on('click', '.challenge', function() {
    console.log('hi')
    var challengee = $(this).parent().data('name')
    $.post('/challenge', {challengee: challengee, challenger: '<%= current_user.name %>'})
  })


</script>


<div id="count"></div>
<div id="users_online" style="border: 1px solid black; width: 300px; height: 600px"><h3>Lobby</h3></div>
<div style="text-align: center; margin-top: 100px">
  <h2>Welcome, <b><%= current_user.name %></b>!</h2><br>
  <div>Lobby</div>
  <a href="/vs_computer" style="text-decoration:none">
    Play with computer
  </a><br><br>
  <a href="/vs_friends" style="text-decoration:none">
    Play with friends
  </a>
</div>
<%= @username %>
